<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GOALSTORM! â€” WORLD CUP 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#050510;
  --panel:#0b0b1f; --neon:#00f6ff; --ok:#22ff88; --warn:#ffcc00; --dim:#666;
  --cyan:#00F6FF;
  --yellow:#FFD60A; --pink:#FF2FC7; --white:#F7F7F2; --purple:#B026FF;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
    margin:0;
    background:radial-gradient(circle at top,#0c0c2a,#000);
    color:#fff;
    font-family:"Press Start 2P",monospace;
    text-align:center;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height: 100vh;
}
/* INITIAL NOTICE POPUP */
.notice-overlay {
    position: fixed;
    inset: 0;
    background: rgba(5,5,16,0.98);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}
.notice-box {
    max-width: 500px;
    width: 90%;
    border: 4px solid var(--pink);
    padding: 45px 25px 25px 25px;
    background: #000;
    position: relative;
}
.notice-close {
    position: absolute;
    top: 8px;
    right: 8px;
    background: transparent;
    border: none;
    color: var(--pink);
    font-size: 24px;
    cursor: pointer;
    padding: 5px 12px;
    line-height: 1;
    z-index: 10;
    font-family: Arial, sans-serif;
}
.notice-close:hover {
    color: var(--white);
}
.notice-box h2 {
    font-size: 14px;
    color: var(--pink);
    margin-bottom: 20px;
    line-height: 1.5;
    padding-right: 30px;
}
.notice-box p {
    font-size: 10px;
    color: var(--white);
    line-height: 1.8;
    text-align: left;
}
/* NAV */
.nav {
  width: 100%;
  max-width: 960px;
  display: flex;
  justify-content: space-around;
  margin: 16px auto 10px;
  padding: 0 10px;
  gap: 6px;
}
.nav a {
  flex: 1;
  font-size: 10px;
  padding: 12px 4px;
  color: #567;
  text-decoration: none;
  border: 1px solid rgba(0,246,255,.25);
  box-shadow: 0 0 6px rgba(0,246,255,.1);
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  transition: all 0.2s;
  background: transparent;
}
.nav a:hover { color: var(--purple); }
.nav a.active { 
  color: var(--white);
  background: var(--purple); 
  border: 2px solid var(--white); 
  box-shadow: 0 0 15px var(--purple); 
  text-shadow: 2px 2px 0px #000;
}
/* PANELS */
.panel{
    width:100%;
    max-width:960px;
    background:var(--panel);
    border:2px solid var(--neon);
    box-shadow:0 0 15px rgba(0,246,255,.2); 
    padding:25px;
    margin-bottom:20px;
}
h1{
    font-size:20px;
    margin:0 0 20px;
    color:var(--neon);
    text-shadow:2px 2px 0px #000; 
    line-height: 1.4;
}
/* UPDATED TEXT STYLING PER REQUEST */
.sys{margin:12px 0;font-size:12px;color:var(--warn);line-height:1.8;}
.sys.prominent, .sys.intro {
    color: var(--white);
    font-size: 14px;
    text-shadow: 2px 2px 0 #000;
    line-height: 1.6;
}
.sys.intro { margin-bottom: 10px; }
/* BANNER */
.banner {
  max-width: 600px;
  width: 100%;
  height: auto;
  display: block;
  margin-bottom: 20px;
}
/* INPUTS - INCREASED VISIBILITY & CONSISTENCY */
input, select{
    width:100%;
    padding:14px;
    margin:12px 0;
    background:#222;
    color:#fff;
    border:2px solid #777;
    font-family:inherit;
    font-size:12px;
    outline: none;
    opacity: 1;
}
input::placeholder { color: #aaa; }
input:focus, select:focus {
    border-color: var(--neon);
    background: #000;
    box-shadow: 0 0 8px rgba(0,246,255,0.4);
}
input:disabled, select:disabled{
    opacity: 1; 
    border-color: #777;
    background: #222;
    cursor: not-allowed;
    color: #fff;
}
button{
    padding:12px 18px;
    margin:8px;
    font-family:inherit;
    font-size:12px;
    background:#000;
    color:var(--neon);
    border:2px solid var(--neon);
    cursor:pointer;
}
button:disabled{opacity:.35;border-color:var(--dim);color:var(--dim);cursor:not-allowed;}
.group{border:1px solid var(--dim);margin:12px 0;padding:15px; background: rgba(255,255,255,0.03);}
.groups-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:15px;}
.group h4{font-size:12px;margin-bottom:10px;color:var(--neon);text-transform:uppercase;}
.team-list{display:flex;flex-direction:column;gap:8px;width:100%;}
.team-row{display:flex;justify-content:space-between;align-items:center;gap:6px;}
.team-name{font-size:12px;color:#fff;flex:1;text-align:left; line-height: 1.4;}
.team-btn{
    font-family:'Press Start 2P',monospace;
    font-size:10px;
    padding:6px 8px;
    border-radius:4px;
    border:1px solid var(--neon);
    background:transparent;
    color:var(--neon);
    cursor:pointer;
    outline:none;
    min-height:30px;
    transition:all .1s;
}
.team-btn.selected-2{background:var(--ok);color:#000;border-color:var(--ok);box-shadow:0 0 8px var(--ok);}
.team-btn.selected-3{background:var(--pink);color:#000;border-color:var(--pink);box-shadow:0 0 8px var(--pink);}
/* TERMS & CONDITIONS CHECKBOXES */
.terms-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin: 15px 0;
    align-items: flex-start;
    padding-left: 5px;
}
.terms-container label {
    font-size: 10px;
    color: var(--neon);
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    text-align: left;
    line-height: 1.4;
    flex-wrap: nowrap;
}
.terms-container .required-text {
    color: var(--pink);
    font-weight: bold;
    white-space: nowrap;
}
.terms-container input[type="checkbox"] {
    width: auto;
    margin: 0;
    transform: scale(1.5);
    cursor: pointer;
    border: 2px solid #777;
}
.input-label {
    font-size: 10px;
    color: #777;
    text-align: left;
    margin-bottom: 5px;
    display: block;
}
/* ARCADE POPUP (ERROR & PROGRESS) */
.arcade-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #000;
    border: 4px solid var(--pink);
    padding: 20px;
    z-index: 1000;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 0 30px rgba(0,0,0,0.9);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.arcade-popup.progress-mode {
    border-color: var(--neon);
}
.popup-msg {
    color: #fff;
    font-size: 12px;
    line-height: 1.6;
    margin-bottom: 15px;
    text-shadow: 2px 2px 0 #000;
}
.popup-btn {
    background: var(--pink);
    color: #000;
    border: none;
    padding: 10px 20px;
    font-family: "Press Start 2P";
    cursor: pointer;
}
.popup-btn:hover { background: #fff; }
/* PROGRESS BAR STYLES */
.progress-track {
    width: 100%;
    height: 20px;
    background: #222;
    border: 2px solid #555;
    margin-top: 10px;
    position: relative;
}
.progress-fill {
    height: 100%;
    background: var(--neon);
    width: 0%;
    transition: width 0.3s ease;
}
/* INFO TOOLTIP */
.info-tooltip {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #000;
    border: 3px solid var(--neon);
    padding: 20px;
    z-index: 999;
    width: 90%;
    max-width: 450px;
    text-align: center;
    box-shadow: 0 0 30px rgba(0,246,255,0.5);
    display: none;
}
.info-tooltip .tooltip-text {
    color: #fff;
    font-size: 11px;
    line-height: 1.8;
    text-shadow: 2px 2px 0 #000;
}
/* MODAL */
.overlay{position:fixed;inset:0;background:rgba(10,10,26,0.96);display:none;align-items:center;justify-content:center;z-index:10;}
.modal{width:92%;max-width:960px;text-align:center;}
.top-player{border:6px solid var(--yellow);padding:16px;font-size:18px;margin-bottom:12px;text-shadow:0 0 12px var(--yellow);min-height:60px;display:flex;align-items:center;justify-content:center;}
.subtitle{font-size:10px;margin-bottom:18px;color:var(--yellow);}
.actions{display:flex;justify-content:center;gap:20px;margin-bottom:20px;}
.grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:20px;}
@media(max-width:600px){ .grid{grid-template-columns:repeat(3,1fr);} }
.player-box{
  border:2px solid rgba(0,246,255,0.2);
  padding:10px 4px;
  font-size:9px;
  text-align:center;
  transition:all .05s;
  color: #888;
}
.player-box.active{
  transform: scale(1.05);
  z-index: 5;
  font-weight: bold;
}
.player-box.selected{
 border-color:var(--yellow) !important;
  color:var(--yellow) !important;
  background: #000 !important;
  text-shadow:0 0 10px var(--yellow);
  box-shadow: inset 0 0 15px rgba(255,214,10,0.3) !important;
  transform: scale(1.1);
}
.info{font-size:9px;margin-top:14px;color:var(--pink);}
.success{display:none;font-size:14px;color:var(--yellow);text-shadow:0 0 12px var(--yellow);}
.shake{animation:shake 0.35s;}
@keyframes shake{0%,100%{transform:translate(0,0);}20%{transform:translate(-6px,0);}40%{transform:translate(6px,0);}60%{transform:translate(-4px,0);}80%{transform:translate(4px,0);}}
/* FINAL POPUP */
.submit-overlay{position:fixed;inset:0;background:rgba(5,5,16,0.98);display:none;align-items:center;justify-content:center;z-index:20;}
.submit-box{max-width:900px;width:94%;border:4px solid var(--yellow);padding:20px;background:#000;}
.submit-box h2{font-size:16px;color:var(--yellow);margin-bottom:14px;}
.submit-box .details{font-size:9px;text-align:left;line-height:1.6;margin-bottom:16px;}
.submit-box .hint{font-size:9px;color:var(--pink);margin-bottom:16px;}
.submit-box a{display:inline-block;margin-top:10px;color:var(--neon);text-decoration:none;border:2px solid var(--neon);padding:8px 10px;}
/* SUMMARY GRID STYLES */
.summary-header{border-bottom:1px solid var(--dim);padding-bottom:12px;margin-bottom:12px;}
.summary-players{color:var(--neon);font-size:11px;margin-bottom:16px;line-height:1.5;}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;border-top:1px solid var(--dim);padding-top:12px;}
.summary-item{background:#111;border:1px solid var(--dim);padding:8px;display:flex;flex-direction:column;justify-content:center;}
.summary-item h5{color:var(--yellow);margin-bottom:6px;font-size:9px;}
.summary-item span{display:block;margin-bottom:3px;font-size:8px;color:#fff;}
.summary-item span.third{color:var(--pink);}
</style>
</head>
<body>

<!-- INITIAL NOTICE POPUP -->
<div class="notice-overlay" id="noticeOverlay">
    <div class="notice-box">
        <button class="notice-close" id="noticeClose" type="button">âœ•</button>
        <h2>SUBMISSION WINDOW NOT YET OPEN</h2>
        <p>THE SUBMISSION WINDOW WILL OPEN NEAR TO THE START OF THE TOURNAMENT. YOU CAN CLICK THROUGH THE PAGE TO UNDERSTAND THE GAME BUT YOUR SELECTIONS WILL NOT BE SUBMITTED AT THIS STAGE.</p>
    </div>
</div>

<div class="nav" id="nav">
  <a href="index.html">HOME</a>
  <a href="predict.html" class="active">PLAY</a>
  <a href="scores.html">SCORES</a>
  <a href="rules.html">RULES</a>
</div>

<img src="banner1.jpg" class="banner" alt="GOALSTORM! Banner">

<div class="panel">
<h1>PLAYER ENTRY TERMINAL</h1>
<input id="username" placeholder="USERNAME">
<input id="email" placeholder="EMAIL" disabled>
<div class="terms-container">
    <label><input type="checkbox" id="privacyCheck"> <span class="required-text">*REQUIRED:</span> I AGREE TO PRIVACY POLICY</label>
    <label><input type="checkbox" id="termsCheck"> <span class="required-text">*REQUIRED:</span> I AGREE TO TERMS OF USE</label>
    <label><input type="checkbox" id="marketingCheck"> I WANT TO HEAR ABOUT FUTURE GOALSTORM COMPETITIONS (OPTIONAL)</label>
</div>
<input id="leaguePin" placeholder="LEAGUE PIN (OPTIONAL)">

<!-- COMBO SELECT POPUP TRIGGER -->
<button id="comboTriggerBtn" disabled style="width:100%;padding:14px;margin:12px 0;background:#222;color:#fff;border:2px solid #777;font-size:12px;text-align:left;">GOALSCORER COMBINATION</button>

<input id="goals" placeholder="TOTAL GROUP STAGE GOALS" type="number" disabled>
<div class="sys" id="s1msg"></div>
</div>

<div class="panel">
<h1>ROUND 1</h1>
<div class="sys intro">PICKING 1ST PLACE IS TOO EASY.</div>
<div class="sys prominent">SELECT 2ND PLACE IN EACH GROUP AND SELECT 8 THIRD-PLACE QUALIFIERS</div>
<div class="groups-grid" id="groupsGrid"></div>
</div>

<button id="lockBtn" disabled>LOCK PICKS & PROCEED TO RANDOM PLAYER SELECTOR</button>

<div id="arcadePopup" class="arcade-popup">
    <div class="popup-msg" id="popupMsg"></div>
    <div id="progressBarContainer" style="display:none; width:100%;">
        <div class="progress-track">
            <div id="progressFill" class="progress-fill"></div>
        </div>
    </div>
    <button id="popupBtn" class="popup-btn">OK</button>
</div>

<div id="infoTooltip" class="info-tooltip">
    <div class="tooltip-text" id="tooltipText"></div>
</div>

<!-- COMBO SELECT MODAL -->
<div class="overlay" id="comboOverlay" style="display:none;">
    <div class="modal">
        <h1 style="color:var(--pink);margin-bottom:20px;">SELECT YOUR GOALSCORER COMBINATION</h1>
        <div style="max-height:400px;overflow-y:auto;">
            <div id="comboGrid" style="display:grid;grid-template-columns:1fr;gap:10px;"></div>
        </div>
        <button id="comboConfirmBtn" style="margin-top:20px;padding:12px 24px;">CONFIRM SELECTION</button>
    </div>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <div class="top-player" id="topPlayer"></div>
    <div class="subtitle">is your random player. Do you want to</div>
    <div class="actions">
      <button id="stickBtn">STICK (AND SUBMIT)</button>
      <button id="twistBtn">TWIST (2 REMAINING)</button>
    </div>
    <div class="grid" id="grid"></div>
    <div class="info" id="info"></div>
    <div class="success" id="success">PICKS SUBMITTED!</div>
  </div>
</div>

<div class="submit-overlay" id="submitOverlay">
  <div class="submit-box">
    <h2>PICKS LOCKED (NOT SUBMITTED - TOURNAMENT NOT STARTED)</h2>
    <div class="details" id="summary"></div>
    <div class="hint">Take a screenshot of this screen for your records.</div>
    <a href="index.html">RETURN TO HOME SCREEN</a>
  </div>
</div>

<script>
'use strict';

/* ---------- STAGE 1 ---------- */
const usernameInput=document.getElementById('username'),
emailInput=document.getElementById('email'),
privacyCheck=document.getElementById('privacyCheck'),
termsCheck=document.getElementById('termsCheck'),
marketingCheck=document.getElementById('marketingCheck'),
leaguePinInput=document.getElementById('leaguePin'),
comboTriggerBtn=document.getElementById('comboTriggerBtn'),
goalsInput=document.getElementById('goals'),
s1msg=document.getElementById('s1msg'),
lockBtn=document.getElementById('lockBtn'),
nav=document.getElementById('nav');

// CLOSE INITIAL NOTICE - moved to after DOM is ready
window.addEventListener('DOMContentLoaded', () => {
    const noticeOverlay = document.getElementById('noticeOverlay');
    const noticeCloseBtn = document.getElementById('noticeClose');

    if(noticeCloseBtn) {
        noticeCloseBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            noticeOverlay.style.display = 'none';
        });
    }

    if(noticeOverlay) {
        noticeOverlay.addEventListener('click', (e) => {
            if(e.target === noticeOverlay) {
                noticeOverlay.style.display = 'none';
            }
        });
    }
});

// COMBO OPTIONS
const COMBO_OPTIONS = [
    'Messi & Ronaldo',
    'Neymar & MbappÃ©',
    'Lewandowski & Haaland',
    'Salah & ManÃ©',
    'Kane & Sterling',
    'ModriÄ‡ & De Bruyne',
    'MbappÃ© & Benzema',
    'Son & Raphinha',
    'Haaland & De Bruyne',
    'VinÃ­cius & Pedri'
];

let selectedCombo = null;

// COMBO MODAL LOGIC
const comboOverlay = document.getElementById('comboOverlay');
const comboGrid = document.getElementById('comboGrid');
const comboConfirmBtn = document.getElementById('comboConfirmBtn');

comboTriggerBtn.onclick = () => {
    comboOverlay.style.display = 'flex';
    renderComboOptions();
};

function renderComboOptions() {
    comboGrid.innerHTML = '';
    COMBO_OPTIONS.forEach(combo => {
        const box = document.createElement('div');
        box.style.cssText = 'border:2px solid rgba(0,246,255,0.3);padding:15px;font-size:12px;cursor:pointer;transition:all 0.2s;';
        box.textContent = combo;
        
        if(selectedCombo === combo) {
            box.style.borderColor = 'var(--yellow)';
            box.style.background = '#000';
            box.style.color = 'var(--yellow)';
            box.style.boxShadow = '0 0 15px var(--yellow)';
        }
        
        box.onclick = () => {
            selectedCombo = combo;
            renderComboOptions();
        };
        
        comboGrid.appendChild(box);
    });
}

comboConfirmBtn.onclick = () => {
    if(!selectedCombo) return;
    comboTriggerBtn.textContent = selectedCombo;
    comboTriggerBtn.style.color = 'var(--yellow)';
    comboOverlay.style.display = 'none';
    goalsInput.disabled = false;
    checkSubmit();
};

// Info tooltip logic
const infoTooltip = document.getElementById('infoTooltip');
const tooltipText = document.getElementById('tooltipText');
let tooltipTimeout;

function showTooltip(msg, duration = 4000) {
    tooltipText.textContent = msg;
    infoTooltip.style.display = 'block';
    
    clearTimeout(tooltipTimeout);
    tooltipTimeout = setTimeout(() => {
        infoTooltip.style.display = 'none';
    }, duration);
}

usernameInput.addEventListener('focus', () => {
    showTooltip('USERNAME WILL BE PUBLICLY VIEWABLE', 3000);
});

leaguePinInput.addEventListener('focus', () => {
    showTooltip('Join an existing league using a code or enter a new code and share it with your friends to set a league up!', 5000);
});

comboTriggerBtn.addEventListener('focus', () => {
    showTooltip('These two players and your Bonus Player (chosen at the end) will earn points for you with goals and assists in the Group Stage.', 6000);
});

goalsInput.addEventListener('focus', () => {
    showTooltip('Enter the total number of goals you think will be scored in all group stage matches - this will be the tiebreaker if one or more players are tied on points in Round 1.', 7000);
});

usernameInput.oninput=()=>{
if(usernameInput.value.length>2) emailInput.disabled=false; checkSubmit(); }
emailInput.oninput=()=>{
if(emailInput.value.includes('@')) comboTriggerBtn.disabled=false; checkSubmit(); }
privacyCheck.onchange=checkSubmit;
termsCheck.onchange=checkSubmit;
marketingCheck.onchange=checkSubmit; 

goalsInput.oninput=()=>{ if(goalsInput.value>0){
s1msg.textContent='PLAYER DATA READY â€” COMPLETE GROUP PICKS'; checkSubmit(); }
}

/* ---------- STAGE 2 ---------- */
const GROUPS=[ 
["MEXICO ðŸ‡²ðŸ‡½","SOUTH AFRICA ðŸ‡¿ðŸ‡¦","SOUTH KOREA ðŸ‡°ðŸ‡·","DEN/MAC/CZE/IRL"],
["CANADA ðŸ‡¨ðŸ‡¦","ITA/NIR/WAL/BOS","QATARðŸ‡¶ðŸ‡¦","SWITZERLANDðŸ‡¨ðŸ‡­"],
["BRAZIL ðŸ‡§ðŸ‡·","MOROCCOðŸ‡²ðŸ‡¦","HAITIðŸ‡­ðŸ‡¹","SCOTLANDðŸ´"],
["USA ðŸ‡ºðŸ‡¸","PARAGUAYðŸ‡µðŸ‡¾","AUSTRALIAðŸ‡¦ðŸ‡º","TUR/ROU/SVK/KOS"],
["GERMANY ðŸ‡©ðŸ‡ª","CURAÃ‡AOðŸ‡¨ðŸ‡¼","IVORY COAST ðŸ‡¨ðŸ‡®","ECUADOR ðŸ‡ªðŸ‡¨"],
["NETHERLANDS ðŸ‡³ðŸ‡±","JAPANðŸ‡¯ðŸ‡µ","UKR/SWE/POL/ALB","TUNISIAðŸ‡¹ðŸ‡³"],
["BELGIUM ðŸ‡§ðŸ‡ª","EGYPTðŸ‡ªðŸ‡¬","IRANðŸ‡®ðŸ‡·","NEW ZEALAND ðŸ‡³ðŸ‡¿"],
["SPAIN ðŸ‡ªðŸ‡¸","CAPE VERDE ðŸ‡¨ðŸ‡»","SAUDI ARABIA ðŸ‡¸ðŸ‡¦","URUGUAYðŸ‡ºðŸ‡¾"],
["FRANCE ðŸ‡«ðŸ‡·","SENEGALðŸ‡¸ðŸ‡³","BOL/SUR/IRQ","NORWAYðŸ‡³ðŸ‡´"],
["ARGENTINA ðŸ‡¦ðŸ‡·","ALGERIAðŸ‡©ðŸ‡¿","AUSTRIAðŸ‡¦ðŸ‡¹","JORDANðŸ‡¯ðŸ‡´"],
["PORTUGAL ðŸ‡µðŸ‡¹","JAM/NCL/DRC","UZBEKISTANðŸ‡ºðŸ‡¿","COLOMBIAðŸ‡¨ðŸ‡´"],
["ENGLAND ðŸ´","CROATIA ðŸ‡­ðŸ‡·","GHANAðŸ‡¬ðŸ‡­","PANAMAðŸ‡µðŸ‡¦"]
];
const letters="ABCDEFGHIJKL".split('');
const MAX_THIRD=8;
const state={ secondPicks:Array(GROUPS.length).fill(null),
thirdPicks:Array(GROUPS.length).fill(null) };
const groupsGrid=document.getElementById('groupsGrid');

const popup = document.getElementById('arcadePopup');
const popupMsg = document.getElementById('popupMsg');
const popupBtn = document.getElementById('popupBtn');
const progressBarContainer = document.getElementById('progressBarContainer');
const progressFill = document.getElementById('progressFill');
popupBtn.onclick = () => { popup.style.display = 'none'; };

function showPopup(msg, isProgress=false, count=0) {
    popupMsg.textContent = msg;
    popup.style.display = 'flex';
    
    if(isProgress) {
        popup.classList.add('progress-mode');
        popupBtn.style.display = 'none';
        progressBarContainer.style.display = 'block';
        const pct = (count / MAX_THIRD) * 100;
        progressFill.style.width = pct + '%';
        
        setTimeout(() => {
            popup.style.display = 'none';
        }, 1500);
    } else {
        popup.classList.remove('progress-mode');
        popupBtn.style.display = 'block';
        progressBarContainer.style.display = 'none';
    }
}

function createGroupEl(groupIndex, teams){
const g=document.createElement('div'); g.className='group';
g.innerHTML=`<h4>GROUP ${letters[groupIndex]}</h4><div class="team-list"></div>`;
const list=g.querySelector('.team-list');
teams.forEach((team,idx)=>{
const row=document.createElement('div');
row.className='team-row';
const nameSpan=document.createElement('span');
nameSpan.className='team-name'; nameSpan.textContent=team;
const btn2=document.createElement('button');
btn2.className='team-btn'; btn2.textContent='2nd';
btn2.onclick=()=>toggleSecond(groupIndex,idx,btn2);
const btn3=document.createElement('button');
btn3.className='team-btn'; btn3.textContent='3rd';
btn3.onclick=()=>toggleThird(groupIndex,idx,btn3);
row.append(nameSpan,btn2,btn3); list.appendChild(row);
});
return g;
}

function renderGroups(){ groupsGrid.innerHTML='';
GROUPS.forEach((g,i)=>groupsGrid.appendChild(createGroupEl(i,g))); }
renderGroups();

function toggleSecond(group,i,btn){
if(state.thirdPicks[group]===i){ showPopup('ERROR: Team already selected as 3rd-place'); return; }
state.secondPicks[group]=state.secondPicks[group]===i?null:i;
btn.closest('.team-list').querySelectorAll('.selected-2').forEach(b=>b.classList.remove('selected-2'));
if(state.secondPicks[group]===i)
btn.classList.add('selected-2');
checkSubmit();
}

function toggleThird(group,i,btn){
if(state.secondPicks[group]===i){ showPopup('ERROR: Team already selected as 2nd-place'); return; }
const total=state.thirdPicks.filter(x=>x!==null).length;

if(state.thirdPicks[group]===i){
    state.thirdPicks[group]=null; 
    btn.classList.remove('selected-3'); 
    const newTotal = state.thirdPicks.filter(x=>x!==null).length;
    showPopup(`${newTotal} THIRD-PLACE TEAMS SELECTED, ${MAX_THIRD - newTotal} REMAINING`, true, newTotal);
}
